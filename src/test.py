from src.stabilzer import OptimalPathStabilizer



import numpy as np
from matplotlib import pyplot as plt

frame_height = 768.0 / 2
crop_height = frame_height-40
corners = {"up": 40, "low": crop_height}

original_trans = [
    14.2948149158,
    -0.476288691695,
    0.987565014994,
    4.45417250309,
    4.57442921405,
    2.91759137251,
    2.22821872353,
    2.60916958339,
    2.55233084581,
    3.84739858202,
    5.97117220052,
    7.12276961366,
    7.24457901367,
    7.24688921354,
    7.21676633576,
    7.36885394699,
    8.77820585324,
    8.74135185666,
    8.45493661918,
    8.21932423533,
    7.42438436629,
    6.7290899805,
    6.35758310784,
    6.96747405869,
    5.0133932344,
    3.15285433836,
    3.81503115489,
    3.31392243353,
    0.865682447677,
    0.736257316544,
    1.67843763732,
    1.20534344214,
    1.53804971524,
    0.657172441063,
    -0.252010208531,
    -1.06970416866,
    -1.42638497462,
    -3.0377374202,
    -3.52269553534,
    -2.15603920714,
    2.00054709779,
    1.28644191233,
    -2.616546008,
    -3.63727107144,
    -3.81291232594,
    -2.07006308916,
    -1.9686007967,
    -3.10275041161,
    -4.1852000766,
    -2.77576233143,
    -0.530994272975,
    -2.27381425248,
    -3.7758699015,
    -1.03188341581,
    0.499162675491,
    0.579853016368,
    2.03294582397,
    3.12539555892,
    4.13458761909,
    4.63975132476,
    5.11863980582,
    6.2294728031,
    5.49175374331,
    5.4986083783,
    6.71097445269,
    8.92377374887,
    7.30310896241,
    6.95973739988,
    8.46426647984,
    12.9654101852,
    9.50312549287,
    4.92488622216,
    3.04940320499,
    5.431402315,
    4.5048079911,
    2.37887667263,
    1.024065966,
    -0.101477887315,
    -0.383068370873,
    1.12167381967,
    0.104866615961,
    -0.354935713222,
    -0.493668285429,
    -0.410986422167,
    -1.47720502677,
    -0.742177328019,
    1.13830055922,
    1.05876662446,
    1.77634652979,
    2.60550245117,
    0.650080827295,
    0.226147504909,
    1.21308599588,
    1.46227689913,
    0.177323676985,
    -0.615832295418,
    -0.605150013465,
    -0.685302481584,
    0.472794575641,
    4.68067278207,
    5.02555398213,
    4.62213488149,
    3.98710492449,
    4.32871658778,
    3.29918902368,
    4.90826543763,
    6.11076327197,
    6.9288242582,
    7.64435571344,
    5.70718364452,
    6.62384524195,
    10.5997314969,
    10.4060787975,
    8.80929418722,
    7.25006534689,
    5.36476266117,
    2.67633299112,
    1.39764934147,
    1.09068247793,
    2.00066051431,
    0.97824420269,
    1.46953211022,
    2.54722599735,
    2.19219424946,
    1.87288304654,
    2.68803585478,
    2.7031876253,
    4.78881026063,
    6.44002664567,
    5.70845104687,
    6.05947175136,
    6.12521125608,
    5.17976122601,
    5.31305467933,
    3.71801910088,
    0.455243715751,
    -3.51285979702,
    -1.48963591622,
    -0.0843753600261,
    1.6301201153,
    1.334060806,
    0.6166132808,
    0.952816835756,
    1.59868719061,
    3.30846535244,
    4.0888458886,
    3.93097981988,
    4.36147356573,
    5.91144427685,
    5.66347454214,
    4.84689149422,
    5.7976134465,
    7.95817623809,
    8.27599456419,
    9.18817870867,
    8.6935749074,
    7.87237088296,
    6.88887157799,
    6.00253738575,
    5.63392099866,
    6.41228129985,
    5.2391701986,
    4.93877350074,
    6.07426389155,
    6.85473977763,
    5.04148723545,
    4.1702797785,
    3.42180838573,
    2.48540936866,
    0.953739215045,
    -0.425226113567,
    -1.15239067852,
    1.3854733051,
    2.78068544851,
    3.74927192428,
    2.36800807859,
    2.48313602201,
    2.41440098025,
    1.95196256047,
    2.77029803154,
    3.2982677217,
    4.86350836929,
    6.20985379461,
    8.17245857331,
    9.42432120921,
    6.97403667887,
    6.73487764921,
    8.23719860121,
    7.27034963588,
    7.76804113793,
    7.6540710835,
    8.28441025557,
    8.31265533683,
    7.97181149614,
    7.38315594711,
    6.38245472629,
    6.18102762224,
    6.03357947421,
    6.3170858445,
    6.32933316573,
    9.41702261133,
    9.99946524741,
    10.5977911065,
    10.0346319011,
    6.7314688068,
    5.69490778852,
    6.30988666617,
    7.15241231085,
    8.13321091282,
    9.30392670386,
    11.6728593643,
    9.90349065054,
    8.93838744678,
    8.29693416585,
    6.86878266794,
    6.8487169838,
    6.22930204022,
    12.4837051963,
    -0.00181352928582,
    6.62847270781,
    6.33824666609,
    6.66909271237,
    6.92708972566,
    5.90211889616,
    5.43297469312,
    5.75011750883,
    5.61630522251,
    5.35724035307,
    4.73731710866,
    5.56084910003,
    5.97303928385,
    6.58378925228,
    13.2262502688,
    0.000889288629413,
    7.68340291721,
    7.39802610711,
    7.10532901947,
    6.65096399183,
    6.1663452764,
    5.683508262,
    5.21098788584,
    5.57859172907,
    5.0495994597,
    4.65584579749,
    4.94733784834,
    5.28365083374,
    4.8743673011,
    8.63561121306,
    -0.000450045419651,
    4.73332745694,
    4.72491751388,
    4.94911272553,
    5.65193450751,
    4.86454805511,
    4.84213461693,
    5.47315159559,
    5.11253506773,
    4.62396653208,
    4.74356183947,
    5.10968440396,
    5.34511149502,
    4.83762601827,
    9.44411594559,
    -0.00110967591005,
    4.15303652835,
    4.56992988592,
    4.41225501519,
    4.81867197412,
    5.27335200156,
    5.31479049985,
    5.08164523367,
    5.49227256011,
    5.60978754436,
    5.63548278543,
    5.50133146475,
    5.26983635396,
    5.66646577321,
    11.0433947217,
    7.56129602933e-05,
    6.96109586705,
    7.01948317493,
    6.37586806662,
    6.4562963672,
    5.81259515278,
    5.66943077101,
    5.56702072434,
    5.26456845978,
    4.92604917871,
    3.93097046878,
    3.96820228074,
    4.0389178273,
    5.16623988455,
    10.8502551301,
    -0.000320837461415,
    6.38177527374,
    6.63925168335,
    6.5489396006,
    5.46506496412,
    3.03395178053,
    0.63547234259,
    1.31045323156,
    1.29155608981,
    1.45064162414,
    1.83271347516,
    1.94683250919,
    1.76452843475,
    1.30319721659,
    3.36285978338,
    -0.00244434318068,
    1.47365722232,
    -0.126506340664,
    -0.917098531644,
    -0.700350974924,
    0.818545652296,
    2.27273676494,
    3.38132830667,
    3.91367742336,
    4.41610620269,
    3.74699563857,
    3.22570280582,
    3.12038995346,
    3.37947625814,
    8.22182266529,
    -0.00421631146897,
    4.56195253787,
    4.1425201956,
    3.03862318468,
    2.83487054565,
    3.34376247141,
    3.50975512178,
    3.86030176231,
    3.99823411696,
    4.14807694708,
    4.42018661938,
    4.25243100319,
    3.82298338802,
    3.45305624374,
    6.73726192383,
    0.00692769116055,
    3.63653740884,
    3.09219415247,
    3.34285564607,
    3.3448826483,
    3.50015723448,
    4.18385720542,
    4.08170696366,
    3.84032814408,
    3.47872832965,
    2.91966144233,
    3.21792211038,
    3.6284758597,
    3.9139679042,
    8.39215003836,
    -0.00534822768618,
    4.02053587412,
    3.57601433136,
    2.67338285523,
    2.69857560412,
    2.48159001211,
    2.54851365381,
    2.18602832995,
    2.64663878232,
    2.09709915129,
    1.7871560135,
    2.30924990999,
    2.06771892792,
    2.26656401455,
    6.4025979325,
    -0.000973747079527,
    2.05233191843,
    -0.0514597625126,
    -0.735194663093,
    0.176706329773,
    0.38962101235,
    0.919330059217,
    3.17275103222,
    6.65170707262,
    6.86209932671,
    5.14456834608,
    5.04938560626,
    5.993885585,
    5.98148110784,
    10.5012332047,
    0.000450092149628,
    5.06055638542,
    4.86352535073,
    5.28217463866,
    4.48525662032,
    4.93943928924,
    3.87522412549,
    2.69458897134,
    2.46888591252,
    3.25881079316,
    3.37987637343,
    4.24809705984,
    3.98755989539,
    3.6613111229,
    6.16571361932,
    0.00145714054502,
    2.9503111102,
    4.16083557627,
    5.31982538339,
    5.34481942449,
    4.2765172888,
    3.43459703756,
    2.65034741964,
    2.32334572426,
    2.21517649527,
    2.81604194073,
    2.80181789133,
    4.09066525345,
    4.80209382881,
    9.803456696,
    0.00191018545038,
    4.39069327796,
    4.12269394373,
    4.10970558762,
    3.45635231424,
    3.6710001354,
    3.34642661091,
    3.59719764799,
    3.89829738544,
    3.46688996421,
    3.63598213707,
    3.70850385445,
    3.04973827784,
    2.80417002872,
    4.68651277148,
    -0.00294584157966,
    1.599503282,
    1.21477869461,
    1.29679256986,
    1.34139763246,
    1.23592328304,
]
original_path = np.cumsum(original_trans)

stabilizer = OptimalPathStabilizer(original_trans, (frame_height - crop_height) / 2)

new_trans, status = stabilizer.stabilize()
new_path = [original_path[t-1] + b for t, b in enumerate(new_trans[1:])]

# The status of the solution is printed to the screen
print ("Status:", status)

plt.plot(original_path, ".", color="red")
plt.plot(np.array(original_path) + frame_height / 2, '-', dashes=[5, 1], color="red")
plt.plot(np.array(original_path) - frame_height / 2, '-', dashes=[5, 1], color="red")

plt.plot(new_path, ".", color="blue")
plt.plot(np.array(new_path) + crop_height / 2, '-', dashes=[5, 1], color="blue")
plt.plot(np.array(new_path) - crop_height / 2, '-', dashes=[5, 1], color="blue")
residual = np.array(original_trans) + np.array(new_trans) - np.array([0] + new_trans[1::])

plt.show()



